<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    
    <title>Titanium で ISRefreshControl を使おう / Socketbase blog</title>
    
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,900,300italic,400italic,700italic,900italic" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet">
    <style type="text/css">
      html,
      body {
        background-color: #f8f8f8;
        font-family: Lato, sans-serif;
        font-size: 16px;
        line-height: 150%;
      }
      header {
      }
      header .container {
        padding-top: 40px;
        padding-bottom: 40px;
      }
      #socket {
        margin-top: 40px;
      }
      #socket .span8 {
        height: 60px;
        background-color: #f8f8f8;
      }
      #socket .span2 {
        height: 60px;
        background-color: #95191d;
      }
      #blogmeta {
        background-color: #95191d;
        color: #fff;
      }
      #blogmeta h2 {
        padding-top: 40px;
      }
      #blogmeta h2,
      #blogmeta ul {
        padding-right: 20px;
        padding-left: 20px;
      }
      #blogmeta a,
      #blogmeta a:hover {
        color: #fff;
      }
      footer {
        background-color: #95191d;
      }
      #base {
        padding-top: 40px;
        padding-bottom: 20px;
        color: #fff;
      }
      #base a,
      #base a:hover {
        color: #fff;
      }
      .blogbody {
        padding-top: 20px;
      }
      .blogindex {
        padding-left: 10px;
        border-left: 5px solid #95191d;
      }
      h1 {
        padding-left: 10px;
        border-left: 5px solid #95191d;
      }
      li {
        line-height: 24px;
      }
      pre code {
        font-family: 'Source Code Pro', sans-serif;
      }
      .bloginfo {
        background-color: #fff;
        border-radius: 2px;
        font-size: 115%;
      }
      .dl-horizontal dt {
        width: 80px;
        margin-bottom: 10px;
      }
      .dl-horizontal dd {
        margin-bottom: 10px;
        margin-left: 100px;
      }
      .dl-horizontal dd ul.unstyled {
        margin-bottom: 0;
      }
      .dl-horizontal dd ul.unstyled .label a,
      .dl-horizontal dd ul.unstyled .label a:hover {
        color: #fff;
        text-decoration: none;
      }
      .socials {
        display: inline;
        margin-right: 10px;
      }
      .socials .icon-stack {
        margin-top: 10px;
      }
      #pagination {
        padding-right: 10px;
        padding-left: 10px;
      }
      .paginate {
        padding-top: 20px;
        padding-bottom: 20px;
      }
      #socialbutton {
        padding-top: 40px;
      }
      #socialbutton li {
        margin-right: 20px;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container text-center">
        <a href="/"><img src="/images/logo.png"></a>
      </div>
    </header>

    <div class="container">
      <div id="main" class="row" role="main">
        <div class="span9 blogbody">
  <div class="page-header">
    <h1>Titanium で ISRefreshControl を使おう</h1>
  </div>
  <p>Titanium で Pull-to-Refresh、イベント処理（scroll / dragend）やフラグ管理が面倒ですよね。
最近だと <a href="https://twitter.com/FokkeZB">@FokkeZB</a> さん作の <a href="https://github.com/FokkeZB/nl.fokkezb.pullToRefresh">nl.fokkezb.pullToRefresh</a> が Alloy の Widget として使えて、ずいぶん便利になってきています。</p>

<p>ただ、やっぱり iOS6 から使える、UIRefreshControl が使いたいところです。
びよーんって伸びて無駄に引っ張りたくなっちゃいます。
Titanium でも使いたくて UIRefreshControl したくて<a href="https://github.com/k0sukey/TiExtendView">モジュール</a>を書いたりしましたが、iOS6 のみなのがネックでした。</p>

<p><img src="/images/blog/TiISRefreshControl.png" alt="TiISRefreshControl" /></p>

<p>そこで <a href="https://github.com/ishkawa/ISRefreshControl">ISRefreshControl</a> の力を借りてしまおうということです。
これは iOS4 / iOS5 でも UIRefreshControl の様に振る舞ってくれる、素敵なライブラリです。
何としてでも Titanium で使いたいところです。</p>

<p>と、言うわけで、<a href="https://github.com/k0sukey/TiISRefreshControl">TiISRefreshControl</a> を書きました。
それでは簡単な使い方をご説明します。
このモジュールはソースコード内で require する必要はありません。
tiapp.xml の &lt;module&gt; に記述するだけで Ti.UI.TableView と Ti.UI.ListView に Pull-to-Refresh を提供します。</p>

<pre><code>&lt;modules&gt;
    &lt;module platform="iphone"&gt;be.k0suke.tiisrefreshcontrol&lt;/module&gt;
&lt;/modules&gt;
</code></pre>

<p>Ti.UI.TableView を例にしてみましょう。以下のコードだけで簡単に Pull-to-Refresh の挙動を実現することができます。</p>

<pre><code>var tableView = Ti.UI.createTableView({
	data: [
		{ title: 'row0' },
		{ title: 'row1' },
		{ title: 'row2' },
		{ title: 'row3' },
		{ title: 'row4' },
		{ title: 'row5' },
		{ title: 'row6' },
		{ title: 'row7' },
		{ title: 'row8' },
		{ title: 'row9' }
	]
});

tableView.addEventListener('refreshstart', function(){
	setTimeout(function(){
		tableView.refreshFinish();
	}, 5000);
});
</code></pre>

<p>では、実際にデータを取得してからの処理はどうでしょうか。
Alloy のデータバインディングとあわせてご覧ください。</p>

<h2 id="view">View</h2>

<pre><code>&lt;Window&gt;
	&lt;ListView id="lists" defaultItemTemplate="list"&gt;
		&lt;Templates&gt;
			&lt;ItemTemplate name="list"&gt;
				&lt;Label bindId="name" class="name"/&gt;
			&lt;/ItemTemplate&gt;
		&lt;/Templates&gt;

		&lt;ListSection id="section" dataCollection="lists" dataTransform="doTransform"&gt;
			&lt;ListItem template="list" name:text="{name}"/&gt;
		&lt;/ListSection&gt;
	&lt;/ListView&gt;
&lt;/Window&gt;
</code></pre>

<h2 id="controller">Controller</h2>

<pre><code>var lists = Alloy.Collections.lists;

function doTransform(model) {
	return model.toJSON();
}

$.lists.addEventListener('refreshstart', function(){
	lists.fetch({
		success: function(){
			$.lists.refreshFinish();
		},
		error: function(){
			$.lists.refreshFinish();
		}
	});
});

$.index.addEventListener('open', function(){
	$.lists.refreshBegin();
});

$.index.open();
</code></pre>

<p>ウィンドウである $.index を開くと同時に Ti.UI.ListView の refreshBegin メソッドを実行します。
このメソッドは、ListView を引っ張る挙動をコードから実行してくれます。
データの受信が完了したら refreshstart イベントが発火すると lists コレクションのフェッチが実行されます。
データの受信が成功失敗にかかわらずインジケータを消してあげないといけませんので、success / error 両方で refreshFinish メソッドを実行します。</p>

<p>というわけで、簡単に UIRefreshControl を Titanium で使えるようにするモジュールのご紹介でした。
他にも細かなメソッドやイベントがありますので、詳しくは <a href="https://github.com/k0sukey/TiISRefreshControl">GitHub の README</a> をご覧ください。</p>

</div>
<div class="span3 bloginfo">
  <dl class="dl-horizontal">
    <dt class="muted">Date</dt>
    <dd>August 22, 2013</dd>
    <dt class="muted">Tags</dt>
    <dd>
      <ul class="unstyled">
      
        <li class="label"><a href="/blog/tags/titanium-mobile.html">Titanium Mobile</a></a></li>
      
        <li class="label"><a href="/blog/tags/module.html">Module</a></a></li>
      
        <li class="label"><a href="/blog/tags/ios.html">iOS</a></a></li>
      
    </dd>
    <dt class="muted">Author</dt>
    <dd>いそべこーすけ</dd>
    
    <dd>
      <ul class="unstyled">
      
        <li class="socials"><a href="https://twitter.com/k0sukey">
          <span class="icon-stack">
            <i class="icon-circle icon-stack-base"></i>
            <i class="icon-twitter icon-light"></i>
          </span></a></li>
      
      
        <li class="socials"><a href="https://www.facebook.com/k0sukey">
          <span class="icon-stack">
            <i class="icon-circle icon-stack-base"></i>
            <i class="icon-facebook icon-light"></i>
          </span></a></li>
      
      
        <li class="socials"><a href="https://github.com/k0sukey">
          <span class="icon-stack">
            <i class="icon-circle icon-stack-base"></i>
            <i class="icon-github-alt icon-light"></i>
          </span></a></li>
      
      </ul>
    </dd>
    
  </dl>
  
  <ul id="pagination" class="unstyled">
    
    <li class="text-left">&laquo; <a href="/blog/2013/07/18/titanium-in-alfred-and-dash.html">Alfred と Dash の連携で Titanium API ドキュメントを見よう</a></li>
    
    
    <li class="text-right"><a href="/blog/2013/09/02/tidkliveblur.html">Titanium で DKLiveBlur を使おう</a> &raquo; </li>
    
  </ul>
  
</div>

      </div>

      <div id="socialbutton" class="row">
        <div class="span12">
          <ul class="unstyled">
            <li class="pull-left twitter"><a href="https://twitter.com/share" class="twitter-share-button twitter-count-vertical" data-lang="ja" data-count="vertical">ツイート</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></li>
            <li class="pull-left hatena"><script type="text/javascript" language="javascript">
              document.write("<a href=\""+document.URL+"\" class=\"hatena-bookmark-button\" data-hatena-bookmark-title=\""+document.title+"\" data-hatena-bookmark-layout=\"vertical-balloon\" title=\"このエントリーをはてなブックマークに追加\"><img src=\"http://b.st-hatena.com/images/entry-button/button-only.gif\" alt=\"このエントリーをはてなブックマークに追加\" width=\"20\" height=\"20\" style=\"border: none;\" /></a>");</script>
              <script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async">
              </script></li>
            <li class="pull-left facebook">
              <script type="text/javascript" language="javascript">
              document.write("<iframe src=\"//www.facebook.com/plugins/like.php?href="+document.URL+"&amp;width=70&amp;height=65&amp;colorscheme=light&amp;layout=box_count&amp;action=like&amp;show_faces=true&amp;send=true&amp;appId=203437546496909\" scrolling=\"no\" frameborder=\"0\" style=\"border:none; overflow:hidden; width:70px; height:65px;\" allowTransparency=\"true\"></iframe>");
              </script></li>
            <li class="pull-left googleplus"><div class="g-plusone" data-size="tall"></div>
              <script type="text/javascript">
              window.___gcfg = {lang: 'ja'};
              (function() {
              var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
              po.src = 'https://apis.google.com/js/plusone.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
              </script></li>
          </ul>
        </div>
      </div>
    </div>

    <div id="socket" class="container">
      <div class="row">
        <div class="span2"></div>
        <div class="span8"></div>
        <div class="span2"></div>
      </div>
    </div>

    <div id="blogmeta" class="container">
      <div class="row">
        <div class="span4">
          <h2>Recent Articles</h2>
          <ul>
            
              <li><a href="/blog/2013/12/13/titaniumadventcalendar2013.html">Android で意図された順序の JSON を Ti.Netwrok.HTTPClient で送信してみよう</a> <span>Dec 13</span></li>
            
              <li><a href="/blog/2013/09/02/tidkliveblur.html">Titanium で DKLiveBlur を使おう</a> <span>Sep  2</span></li>
            
              <li><a href="/blog/2013/08/22/tiisrefreshcontrol.html">Titanium で ISRefreshControl を使おう</a> <span>Aug 22</span></li>
            
              <li><a href="/blog/2013/07/18/titanium-in-alfred-and-dash.html">Alfred と Dash の連携で Titanium API ドキュメントを見よう</a> <span>Jul 18</span></li>
            
              <li><a href="/blog/2013/07/11/titan.html">Titan になりました</a> <span>Jul 11</span></li>
            
              <li><a href="/blog/2013/06/24/ios.html">iOS のプリセットサウンドを鳴らそう</a> <span>Jun 24</span></li>
            
              <li><a href="/blog/2013/06/23/ticameraview.html">TiCameraView でカメラをアプリに埋め込もう</a> <span>Jun 23</span></li>
            
          </ul>
        </div>

        <div class="span4">
          <h2>Tags</h2>
          <ul>
            
              <li><a href="/blog/tags/titanium-mobile.html">Titanium Mobile</a> (6)</a></li>
            
              <li><a href="/blog/tags/module.html">Module</a> (4)</a></li>
            
              <li><a href="/blog/tags/ios.html">iOS</a> (4)</a></li>
            
              <li><a href="/blog/tags/.html">その他</a> (1)</a></li>
            
              <li><a href="/blog/tags/api.html">API</a> (1)</a></li>
            
              <li><a href="/blog/tags/alfred.html">Alfred</a> (1)</a></li>
            
              <li><a href="/blog/tags/dash.html">Dash</a> (1)</a></li>
            
              <li><a href="/blog/tags/titanium.html">Titanium</a> (1)</a></li>
            
              <li><a href="/blog/tags/android.html">Android</a> (1)</a></li>
            
              <li><a href="/blog/tags/advent-calendar.html">Advent Calendar</a> (1)</a></li>
            
          </ul>
        </div>

        <div class="span4">
          <h2>By Year</h2>
          <ul>
            
              <li><a href="/blog/2013.html">2013</a> (7)</a></li>
            
          </ul>
        </div>
      </div>
    </div>

    <footer>
      <div id="base" class="container">
        <div class="row">
          <div class="span12">
            <p class="text-center"><a href="http://www.socketbase.co.jp">&copy; Socketbase Inc.</a></p>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
